<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ููุญุฉ ุงูุชุญูู - Telegram Bot</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { direction: rtl; }
.sidebar { height: 100vh; background: #343a40; color: white; padding: 20px; }
.sidebar a { color: white; display: block; margin: 10px 0; text-decoration: none; }
.sidebar a:hover { text-decoration: underline; }
</style>
</head>
<body>
<div class="d-flex">
  <div class="sidebar">
    <h4>ููุญุฉ ุงูุชุญูู</h4>
    <a href="#" onclick="showSection('channels')">๐บ ุงููููุงุช</a>
    <a href="#" onclick="showSection('sessions')">๐ก ุงูุฌูุณุงุช</a>
    <a href="#" onclick="showSection('logs')">๐ ุงูุณุฌูุงุช</a>
    <a href="#" onclick="toggleBot()">๐ ุชุดุบูู/ุฅููุงู ุงูุจูุช</a>
    <a href="/logout">๐ช ุชุณุฌูู ุงูุฎุฑูุฌ</a>
  </div>
  <div class="container-fluid p-4">
    
    <div id="channels-section">
      <h3>ุงููููุงุช</h3>
      <form id="add-channel-form" class="mb-3">
        <div class="row g-2">
          <div class="col"><input type="text" class="form-control" name="channel" placeholder="ุงุณู ุงูููุงุฉ" required></div>
          <div class="col"><input type="text" class="form-control" name="bot" placeholder="ุงูุจูุช ุงููุฏู" required></div>
          <div class="col"><button type="submit" class="btn btn-primary">ุฅุถุงูุฉ ููุงุฉ</button></div>
        </div>
      </form>
      <table class="table table-bordered">
        <thead>
          <tr><th>ุงูููุงุฉ</th><th>ุงูุจูุช ุงููุฏู</th><th>ุงูุญุงูุฉ</th><th>ุฅุฌุฑุงุกุงุช</th></tr>
        </thead>
        <tbody id="channels-table"></tbody>
      </table>
    </div>
    
    <div id="sessions-section" style="display:none;">
      <h3>ุงูุฌูุณุงุช</h3>
      <form id="add-session-form">
        <div class="row g-2 mb-3">
          <div class="col"><input type="number" class="form-control" name="api_id" placeholder="API ID" required></div>
          <div class="col"><input type="text" class="form-control" name="api_hash" placeholder="API HASH" required></div>
          <div class="col"><button type="submit" class="btn btn-primary">ุฅุถุงูุฉ ุฌูุณุฉ</button></div>
        </div>
      </form>
      <table class="table table-bordered">
        <thead><tr><th>API ID</th><th>API HASH</th><th>Session Name</th></tr></thead>
        <tbody id="sessions-table"></tbody>
      </table>
    </div>
    
    <div id="logs-section" style="display:none;">
      <h3>ุงูุณุฌูุงุช</h3>
      <table class="table table-bordered">
        <thead><tr><th>ุงูููุช</th><th>ุงูููุงุฉ</th><th>ุงููุต ุงูุฃุตูู</th><th>ุงููุต ุงูููุธู</th><th>ุงูุจูุช ุงููุฏู</th><th>ุงูุญุงูุฉ</th></tr></thead>
        <tbody id="logs-table"></tbody>
      </table>
    </div>
    
  </div>
</div>

<script>
function showSection(section) {
  document.getElementById('channels-section').style.display = 'none';
  document.getElementById('sessions-section').style.display = 'none';
  document.getElementById('logs-section').style.display = 'none';
  document.getElementById(section+'-section').style.display = 'block';
}

// Load data
async function loadChannels() {
  const res = await fetch('/api/channels');
  const data = await res.json();
  const tbody = document.getElementById('channels-table');
  tbody.innerHTML = '';
  data.forEach(c=>{
    tbody.innerHTML += `<tr>
      <td>${c.channel_name}</td>
      <td>${c.bot_target}</td>
      <td>${c.active ? 'ููุนู':'ูููู'}</td>
      <td>
        <button onclick="toggleChannel('${c.channel_name}','${c.active ? 'stop':'start'}')" class="btn btn-sm btn-warning">${c.active ? 'ุฅููุงู':'ุชูุนูู'}</button>
        <button onclick="deleteChannel('${c.channel_name}')" class="btn btn-sm btn-danger">ุญุฐู</button>
      </td>
    </tr>`;
  });
}

async function toggleChannel(channel, action) {
  await fetch('/api/toggle_channel', {
    method:'POST',
    body: new URLSearchParams({channel, action})
  });
  loadChannels();
}

async function deleteChannel(channel) {
  await fetch('/api/delete_channel', {
    method:'POST',
    body: new URLSearchParams({channel})
  });
  loadChannels();
}

document.getElementById('add-channel-form').addEventListener('submit', async e=>{
  e.preventDefault();
  const form = new FormData(e.target);
  await fetch('/api/add_channel', {method:'POST', body: form});
  e.target.reset();
  loadChannels();
});

loadChannels();
</script>
</body>
</html>
