<!doctype html>
<!doctype html>
<html>
<head><meta charset="utf-8"><title>Dashboard</title>
<link rel="stylesheet" href="/static/style.css">
<script>
async function apiPost(path, data){
  let fd = new FormData();
  for (const k in data) fd.append(k, data[k]);
  let res = await fetch(path, {method:'POST', body:fd});
  return res.json();
}
async function addChannel(){
  let channel = document.getElementById('channel').value;
  let bot = document.getElementById('bot').value;
  let r = await apiPost('/api/add_channel', {channel:channel, bot:bot});
  if(r.ok) location.reload();
  else alert(JSON.stringify(r));
}
async function deleteChannel(name){
  if(!confirm('Delete '+name+'?')) return;
  let r = await apiPost('/api/delete_channel', {channel:name});
  if(r.ok) location.reload();
}
async function toggleChannel(name, action){
  let r = await apiPost('/api/toggle_channel', {channel:name, action:action});
  if(r.ok) location.reload();
}
async function setBotToken(){
  let token = document.getElementById('bot_token').value;
  let r = await apiPost('/api/set_bot_token', {bot_token:token});
  if(r.ok) alert('Saved'); else alert(JSON.stringify(r));
}
async function status(){
  let res = await fetch('/api/status');
  let j = await res.json();
  document.getElementById('status').innerText = j.bot_running ? 'running' : 'stopped';
  document.getElementById('active_list').innerText = j.active_channels.join(', ');
}
setInterval(status,3000);
</script>
</head>
<body>
  <h1>Premium Dashboard</h1>
  <p>Bot status: <span id="status">unknown</span></p>
  <p>Active channels: <span id="active_list"></span></p>
  <p><a href="/logs">View logs</a> | <a href="/logout">Logout</a></p>

  <h3>Bot Token (set here or use BOT_TOKEN env)</h3>
  <input id="bot_token" placeholder="BOT_TOKEN"> <button onclick="setBotToken()">Save token</button>

  <h3>Add channel</h3>
  <input id="channel" placeholder="channel (without @)">
  <input id="bot" placeholder="target bot (without @)">
  <button onclick="addChannel()">Add</button>

  <h3>Channels</h3>
  <table border=1 cellpadding=6>
    <tr><th>ID</th><th>Channel</th><th>Target</th><th>Active</th><th>Actions</th></tr>
    {% for id, ch, bot, active, created in channels %}
      <tr>
        <td>{{ id }}</td>
        <td>{{ ch }}</td>
        <td>{{ bot }}</td>
        <td>{{ 'Yes' if active else 'No' }}</td>
        <td>
          <button onclick="toggleChannel('{{ ch }}', '{{ 'stop' if active else 'start' }}')">{{ 'Stop' if active else 'Start' }}</button>
          <button onclick="deleteChannel('{{ ch }}')">Delete</button>
        </td>
      </tr>
    {% endfor %}
  </table>
</body>
</html>